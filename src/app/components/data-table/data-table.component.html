<div class="data-table-container">
    <!-- Header Section with Search and Create Button -->
    @if (config.searchEnabled !== false || config.createButtonEnabled) {
    <div class="table-header">
        @if (config.searchEnabled !== false) {
        <div class="search-section">
            <mat-form-field appearance="outline" class="search-field">
                <mat-label>Search</mat-label>
                <input matInput [(ngModel)]="searchValue" (input)="applyFilter()"
                    [placeholder]="config.searchPlaceholder || 'Search...'">
                <mat-icon matSuffix>search</mat-icon>
                <!-- Clear Search Button -->
                @if (searchValue) {
                <button matSuffix mat-icon-button aria-label="Clear" (click)="clearSearch()">
                    <mat-icon>close</mat-icon>
                </button>
                }

            </mat-form-field>
        </div>
        }

        <!-- Create Button -->
        @if (config.createButtonEnabled) {
        <div class="action-section">
            <button mat-raised-button color="primary" (click)="onCreateClick()" class="create-button">
                <mat-icon>add</mat-icon>
                {{ config.createButtonLabel || 'Create New' }}
            </button>
        </div>
        }

    </div>
    }


    <!-- Loading Indicator -->
    @if (loading) {
    <div class="loading-container">
        <mat-spinner></mat-spinner>
    </div>
    }


    <!-- Data Table Section -->
    @if (!loading) {
    <div class="table-wrapper">
        <div class="table-container" [style.max-height]="config.maxHeight || '600px'">
            <table mat-table [dataSource]="dataSource" matSort class="data-table"
                [style.min-width]="config.tableMinWidth || '1200px'">

                <!-- Dynamic Columns -->
                @for (column of config.columns; track $index) {
                <ng-container [matColumnDef]="column.key">
                    <!-- Sortable Column Header -->
                    @if (column.sortable !== false) {
                    <ng-container>
                        <th mat-header-cell *matHeaderCellDef mat-sort-header="{{ column.key }}" class="sticky-header"
                            [class]="getColumnClass(column)" [ngStyle]="getColumnStyle(column)">
                            {{ column.label }}
                        </th>
                    </ng-container>
                    }


                    <!-- Non-sortable Column Header -->
                    @if (column.sortable === false) {
                    <ng-container>
                        <th mat-header-cell *matHeaderCellDef class="sticky-header" [class]="getColumnClass(column)"
                            [ngStyle]="getColumnStyle(column)">
                            {{ column.label }}
                        </th>
                    </ng-container>
                    }


                    <td mat-cell *matCellDef="let element" [class]="getColumnClass(column)"
                        [ngStyle]="getColumnStyle(column)" (click)="onRowClick(element)">

                        <!-- Badge Type -->
                        @if (column.type === 'badge') {
                        <span class="status-badge" [class]="getBadgeClass(column, element[column.key])">
                            {{ getBadgeLabel(column, element[column.key]) }}
                        </span>
                        }

                        <!-- Regular Text/Date/Currency -->
                        @if (column.type !== 'badge') {
                        <span>
                            {{ formatCellValue(column, element[column.key]) }}
                        </span>
                        }
                    </td>
                </ng-container>
                }


                <!-- Actions Column -->
                @if (config.actions && config.actions.length > 0) {
                <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef class="sticky-header sticky-actions">Actions</th>
                    <td mat-cell *matCellDef="let element" class="sticky-actions">
                        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Actions">
                            <mat-icon>more_vert</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                            @for (action of config.actions; track $index) {
                            <button mat-menu-item (click)="onActionClick(action.key, element)"
                                [class]="action.color ? action.color + '-action' : ''"
                                [style.display]="isActionVisible(action, element) ? 'flex' : 'none'">
                                <mat-icon [style.color]="action.color">{{ action.icon }}</mat-icon>
                                <span>{{ action.label }}</span>
                            </button>
                            }

                        </mat-menu>
                    </td>
                </ng-container>
                }
                <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
            </table>
        </div>
    </div>
    }


    <!-- No Data Message -->
    @if (!loading && dataSource.data.length === 0) {
    <div class="no-data-container">
        <mat-icon>inbox</mat-icon>
        <h3>No data available</h3>
        <p>There are no records to display.</p>
    </div>
    }


    <!-- Pagination Section -->
    @if (config.paginationEnabled !== false && !loading && (dataSource.data.length > 0 || config.serverSidePagination))
    {
    <div class="pagination-wrapper">
        <mat-paginator #paginator [pageSizeOptions]="config.pageSizeOptions || [5, 10, 20, 50]"
            [pageSize]="config.defaultPageSize || 5"
            [length]="config.serverSidePagination ? (config.totalItems || 0) : dataSource.data.length"
            showFirstLastButtons="true" aria-label="Select page">
        </mat-paginator>
    </div>
    }

</div>